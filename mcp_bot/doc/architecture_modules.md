# Архітектура GZDoom: модулі, інтерфейси, зв’язки

## 1. Основні модулі рушія

- **Core (Ядро)**
  - Файли: `d_main.cpp`, `d_main.h`, `doomdef.h`, `doomstat.h`, `d_event.h`
  - Відповідає за старт, ініціалізацію, головний цикл, обробку подій, менеджмент ресурсів, глобальні налаштування.
  - Інтерфейси: функції запуску (`D_DoomMain`), ініціалізації (`D_InitGame`), головний цикл (`D_DoomLoop`), обробка подій (`D_ProcessEvents`).

- **Game Logic (Ігрова логіка)**
  - Файли: `g_game.cpp`, `g_game.h`, `g_level.cpp`, `g_level.h`, `g_levellocals.h`
  - Відповідає за стан гри, логіку рівнів, гравців, акторів, AI, фізику, тригери, сценарії.
  - Інтерфейси: `G_Ticker()` (оновлення стану), `G_Responder()` (обробка input), структури `FLevelLocals`, `player_t`, `AActor`.

- **Rendering (Рендеринг)**
  - Файли: (залежить від бекенду, але основні точки — `d_main.cpp` для дисплею, рендерер у відповідних підмодулях)
  - Відповідає за побудову кадру, BSP, освітлення, UI, HUD.
  - Інтерфейси: `D_Display()`, API рендерера, доступ до даних про камеру, акторів, текстури.

- **Resource Management (Ресурси)**
  - Файли: `filesystem.h`, менеджери ресурсів, парсери WAD/PK3, завантажувачі текстур, аудіо, скриптів.
  - Інтерфейси: API для пошуку, завантаження, кешування ресурсів.

- **Input/Events (Ввід/Події)**
  - Файли: `d_event.h`, `events.cpp`, обробники input, мережеві події.
  - Інтерфейси: черга подій, API для підписки/обробки подій.

- **Audio**
  - Файли: аудіо бекенди, менеджери музики, звуків, саундфонти.
  - Інтерфейси: API для відтворення, завантаження, мікшування звуків.

- **External Libraries**
  - Папки: `libraries/`
  - Інтерфейси: інкапсульовані API сторонніх бібліотек (компресія, Discord, Vulkan, тощо).

## 2. Зв’язки між модулями

- Core ініціалізує всі інші модулі, координує їхню роботу через головний цикл.
- Game Logic взаємодіє з Core (через події, глобальні змінні), з Resource Management (для завантаження даних), з Rendering (надає дані для рендеру).
- Rendering отримує дані про стан світу від Game Logic, ресурси — від Resource Management.
- Input/Events надсилає події у Core, Game Logic, Rendering.
- Audio отримує команди від Game Logic/Core, ресурси — від Resource Management.

## 3. Інтерфейси модулів (приклади)

- Core:  
  - `void D_DoomMain();`
  - `void D_InitGame();`
  - `void D_DoomLoop();`
- Game Logic:  
  - `void G_Ticker();`
  - `bool G_Responder(event_t* ev);`
  - `struct FLevelLocals;`
  - `struct player_t;`
  - `class AActor;`
- Rendering:  
  - `void D_Display();`
  - API для отримання позиції камери, списку акторів, текстур.
- Resource Management:  
  - `FileReader* W_OpenFile(const char* name);`
  - API для пошуку ресурсів за іменем/типом.
- Input/Events:  
  - `void D_PostEvent(event_t* ev);`
  - `event_t* D_PopEvent();`

---

# Опис ізольованих модулів

## Game Logic (g_game.cpp, g_level.cpp, g_levellocals.h)
- Основні сутності:  
  - `FLevelLocals` — описує стан рівня, масив гравців, ітератор по акторам.
  - `player_t` — стан гравця (позиція, здоров’я, інвентар, камера).
  - `AActor` — базовий клас для всіх об’єктів світу (гравці, монстри, предмети).
- Зв’язки:  
  - `FLevelLocals` містить масив `player_t`, ітератор по `AActor`.
  - `AActor` має посилання на рівень, координати, стан, методи взаємодії.
- Взаємодія:  
  - `G_Ticker()` оновлює всі сутності, викликає AI, фізику, обробляє тригери.
  - `G_Responder()` обробляє input, змінює стан гравця/актора.

## Rendering
- Основні сутності:  
  - Камера (AActor, на яку дивиться гравець).
  - BSP-дерево, сектори, текстури, спрайти.
- Зв’язки:  
  - Rendering отримує дані про камеру, акторів, текстури від Game Logic та Resource Management.
- Взаємодія:  
  - `D_Display()` викликає рендерер, який проходить BSP, визначає видимі об’єкти, малює кадр.

## Resource Management
- Основні сутності:  
  - Файлові дескриптори, кеш ресурсів, парсери WAD/PK3.
- Зв’язки:  
  - Всі модулі звертаються до Resource Management для завантаження даних.
- Взаємодія:  
  - API для пошуку, відкриття, кешування ресурсів.

## Input/Events
- Основні сутності:  
  - Черга подій, структури подій (input, мережа, системні).
- Зв’язки:  
  - Події надходять у Core, Game Logic, Rendering.
- Взаємодія:  
  - API для додавання, отримання, обробки подій.

---

# Опис командних потоків

## Потік запуску
1. main() → D_DoomMain() → D_InitGame() → D_DoomLoop()
2. D_DoomLoop:
   - G_Ticker() — оновлення стану світу
   - G_Responder() — обробка подій
   - D_Display() — рендеринг кадру

## Потік обробки подій
- Input/Events → Core → Game Logic (G_Responder) → зміна стану → Rendering

## Потік завантаження ресурсів
- Game Logic/Rendering/Audio → Resource Management → файлові системи/архіви → кеш → модуль

---

*У цьому документі не описано жодної реалізованої інтеграції з LLM/MCP. Всі точки розширення — лише потенційні.*
